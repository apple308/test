<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>침수지도</title>
    <style>
        html,
        body {
            margin: 0;
            padding: 0;
            height: 100%;
        }

        .header {
            width: 100%;
            height: 15%;
            font-size: 30px;
        }

        .nav {
            width: 15%;
            height: 85%;
            float: left;
        }

        .section {
            width: 85%;
            height: 85%;
            float: left;
        }
    </style>
</head>

<body>
    <header class="header">
        <div style="position: absolute; left: 10px;">
            <p>침수지도</p>
        </div>
    </header>
    <nav class="nav">
        <div style="width: 100%; height: 100%;">
            <fieldset>
                <legend>침수심 설정</legend>
                <input type="text" placeholder="강수량 입력 예 : 100">
                <input type="button" value="적용"><br>
                <p style="font-size: 5px; color: red;">
                    침수심이란?
                </p>
                <P style="font-size: 5px; color:  red;">
                    100년 빈도의 강우량을 가정한 가상 홍수 피해 수심을 나타내는 말로
                    (파고 - 현재 지역의 해발고도)로 나타냄
                </P>
            </fieldset>
            <br>
            <fieldset>
                <legend>침수심 표시 지역 설정</legend>
                <details>
                    <summary>부산시 남구</summary>
                    <form>
                        <select id="areaSelect" onchange="showSelectedArea()">
                            <option value="">지역 선택</option>
                            <option value="daeyeon1">부산광역시 대연 1동</option>
                            <option value="daeyeon2">부산광역시 대연 2동</option>
                        </select>
                    </form>
                </details>
            </fieldset>
            <br>
            <fieldset>
                <legend>대피소</legend>
                <input type="button" value="대피소 표시" onclick="showMarkers()">
                <input type="button" value="대피소 해제" onclick="hideMarkers()">
            </fieldset>
        </div>
    </nav>
    <section class="section">
        <div id="map" style="width:100%;height:100%;"></div>
        <script
            src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=e1c41ea5a19c26dc62e448d5184b0f1d&libraries=clusterer"></script>
        <script>
            var mapContainer = document.getElementById('map'), // 지도를 표시할 div 
                mapOption = {
                    center: new kakao.maps.LatLng(35.134080249513474, 129.10317348438963), // 지도의 중심좌표
                    level: 6, // 지도의 확대 레벨
                    mapTypeId: kakao.maps.MapTypeId.ROADMAP // 지도종류
                };
            // 지도를 생성한다
            var map = new kakao.maps.Map(mapContainer, mapOption);
            var polygons = [];

            // 지도에 표시된 마커 객체를 가지고 있을 배열입니다
            var markers = [];
            // 마커 클러스터러를 생성합니다 
            var clusterer = new kakao.maps.MarkerClusterer({
                map: map, // 마커들을 클러스터로 관리하고 표시할 지도 객체 
                averageCenter: true, // 클러스터에 포함된 마커들의 평균 위치를 클러스터 마커 위치로 설정 
                minLevel: 10 // 클러스터 할 최소 지도 레벨 
            })
            var 데이터 = [
                [35.1370848, 129.0928946, '<div style="padding: 5px">대연초등학교</div>'],
                [35.1365243, 129.0843734, '<div style="padding: 5px">부산광역시남구청대강당</div>'],
                [35.1308035, 129.1081982, '<div style="padding: 5px">용문초등학교</div>'],
                [35.1227085, 129.1089498, '<div style="padding: 5px">용호초등학교</div>'],
                [35.1287502, 129.081255, '<div style="padding: 5px">성지고등학교</div>'],
                [35.1331989, 129.073643, '<div style="padding: 5px">대양전자통신고등학교</div>'],
                [35.1444702, 129.0872224, '<div style="padding: 5px">동천고등학교</div>'],
                [35.129311, 129.0780009, '<div style="padding: 5px">신연초등학교</div>'],
                [35.1256998, 129.0759485, '<div style="padding: 5px">우암초등학교</div>'],
                [35.1453363, 129.072865, '<div style="padding: 5px">문현초등학교</div>']
            ];

            for (var i = 0; i < 데이터.length; i++) {
                // 마커를 생성합니다
                var marker = new kakao.maps.Marker({
                    position: new kakao.maps.LatLng(데이터[i][0], 데이터[i][1])
                });

                //인포윈도우 생성합니다
                var infowindow = new kakao.maps.InfoWindow({
                    content: 데이터[i][2] // 인포윈도우에 표시할 내용
                });
                kakao.maps.event.addListener(marker, 'mouseover', makeOverListener(map, marker, infowindow));
                kakao.maps.event.addListener(marker, 'mouseout', makeOutListener(infowindow));
                markers.push(marker);
            }

            // 클러스터러에 마커들을 추가합니다
            clusterer.addMarkers(markers);

            // 인포윈도우를 표시하는 클로저를 만드는 함수입니다 
            function makeOverListener(map, marker, infowindow) {
                return function () {
                    infowindow.open(map, marker);
                };
            }

            // 인포윈도우를 닫는 클로저를 만드는 함수입니다 
            function makeOutListener(infowindow) {
                return function () {
                    infowindow.close();
                };
            }

            // 배열에 추가된 마커들을 지도에 표시하거나 삭제하는 함수입니다
            function setMarkers(map) {
                for (var i = 0; i < markers.length; i++) {
                    markers[i].setMap(map);
                }
            }

            // "마커 보이기" 버튼을 클릭하면 호출되어 배열에 추가된 마커를 지도에 표시하는 함수입니다
            function showMarkers() {
                setMarkers(map);
                clusterer.addMarkers(markers);
            }

            // "마커 감추기" 버튼을 클릭하면 호출되어 배열에 추가된 마커를 지도에서 삭제하는 함수입니다
            function hideMarkers() {
                setMarkers(null);
                clusterer.clear();
            }

            var polygonPositions = {
                daeyeon1: [
                    new kakao.maps.LatLng(35.135750, 129.100869),
                    new kakao.maps.LatLng(35.133664, 129.105280),
                    new kakao.maps.LatLng(35.131578, 129.104699),
                    new kakao.maps.LatLng(35.131726, 129.100498)
                ],
                daeyeon2: [
                    new kakao.maps.LatLng(35.139289, 129.101165),
                    new kakao.maps.LatLng(35.138411, 129.105232),
                    new kakao.maps.LatLng(35.135326, 129.105010),
                    new kakao.maps.LatLng(35.134274, 129.100523)
                ]
            }
            function showSelectedArea() {
                // 이전에 표시된 다각형 제거
                removePolygons();

                var areaSelect = document.getElementById("areaSelect");
                var selectedValue = areaSelect.value;

                if (selectedValue !== "") {
                    // 선택한 지역의 다각형 생성
                    var selectedPolygon = new kakao.maps.Polygon({
                        path: polygonPositions[selectedValue], // 선택한 지역의 좌표 배열
                        strokeWeight: 2, // 선의 두께
                        strokeColor: '#FF0000', // 선의 색상
                        strokeOpacity: 0.8, // 선의 투명도
                    });

                    // 선택한 지역의 다각형 지도에 표시
                    selectedPolygon.setMap(map);

                    // 생성된 다각형을 배열에 추가
                    polygons.push(selectedPolygon);

                    // 선택한 지역으로 지도 중심 좌표 변경
                    map.setCenter(new kakao.maps.LatLng(35.1375, 129.103));
                }
            }

            // 이전에 표시된 다각형 제거
            function removePolygons() {
                if (polygons.length > 0) {
                    for (var i = 0; i < polygons.length; i++) {
                        polygons[i].setMap(null);
                    }
                    polygons = [];
                }
            }


        </script>
    </section>
</body>

</html>